const ProjectSampleData = {
  "proid": "p2203_aa71s",
  "cliid": "c2203_aa75s",
  "desid": "d2105_aa02s",
  "service": {
    "serid": "s2011_aa02s",
    "xValue": "B",
    "online": false
  },
  "proposal": {
    "status": "발송 예약",
    "date": new Date("2022-04-04T02:41:38.970Z"),
    "detail": [
      {
        "desid": "d1902_aa01s",
        "fee": [
          {
            "method": "offline",
            "partial": false,
            "amount": 3999000,
            "distance": {
              "number": 0,
              "amount": 0,
              "distance": "0km",
              "time": "0시간 0분",
              "limit": 5
            },
            "discount": 0
          }
        ],
        "pictureSettings": [
          {
            "position": "0",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "width: 66.5%; height: 66%; top: 0%; left: 0%; background-image: url(\"/corePortfolio/listImage/p125/t6p125.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p125/t6p125.jpg"
          },
          {
            "position": "1",
            "sgTrue": "s",
            "unionPo": "right",
            "styleText": "width: 32.8%; height: 66%; top: 0%; left: 67.2%; background-image: url(\"/corePortfolio/forecast/p200/photo13.jpg\");",
            "imgSrc": "/corePortfolio/forecast/p200/photo13.jpg"
          },
          {
            "position": "2",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "top: 67%; left: 0%; width: 32.8%; height: 33%; background-image: url(\"/corePortfolio/listImage/p39/t23p39.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p39/t23p39.jpg"
          },
          {
            "position": "3",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "top: 67%; left: 33.5%; width: 33%; height: 33%; background-image: url(\"/corePortfolio/listImage/p39/t4p39.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p39/t4p39.jpg"
          },
          {
            "position": "4",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "top: 67%; left: 67.2%; width: 32.8%; height: 33%; background-image: url(\"/corePortfolio/listImage/p125/t18p125.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p125/t18p125.jpg"
          }
        ],
        "description": [
          "전체적으로 모던하면서도, 동시에 편안하고 고급스러운 홈스타일링으로 집을 만들어 드립니다.",
          "디자이너로서 공간 활용 또는 스타일링에 대한 다양한 제안을 잘 하시는 편입니다.",
          "작업을 진행한 고객평 : \"원하는 것보다 더 좋은 제안을 받게되어 만족스러워요.\""
        ]
      },
      {
        "desid": "d1907_aa01s",
        "fee": [
          {
            "method": "offline",
            "partial": false,
            "amount": 3751000,
            "distance": {
              "number": 0,
              "amount": 0,
              "distance": "0km",
              "time": "0시간 0분",
              "limit": 5
            },
            "discount": 0
          }
        ],
        "pictureSettings": [
          {
            "position": "0",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "width: 66.5%; height: 66%; top: 0%; left: 0%; background-image: url(\"/corePortfolio/listImage/p89/t4p89.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p89/t4p89.jpg"
          },
          {
            "position": "1",
            "sgTrue": "s",
            "unionPo": "right",
            "styleText": "width: 32.8%; height: 66%; top: 0%; left: 67.2%; background-image: url(\"/corePortfolio/listImage/p33/t14p33.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p33/t14p33.jpg"
          },
          {
            "position": "2",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "width: 32.8%; height: 33%; top: 67%; left: 0%; background-image: url(\"/corePortfolio/listImage/p61/t2p61.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p61/t2p61.jpg"
          },
          {
            "position": "3",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "width: 33%; height: 33%; top: 67%; left: 33.5%; background-image: url(\"/corePortfolio/listImage/p118/t6p118.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p118/t6p118.jpg"
          },
          {
            "position": "4",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "width: 32.8%; height: 33%; top: 67%; left: 67.2%; background-image: url(\"/corePortfolio/listImage/p61/t15p61.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p61/t15p61.jpg"
          }
        ],
        "description": [
          "패브릭과 우드톤을 사용한 내추럴한 스타일링으로 공간을 따뜻하게 만들어 드립니다.",
          "고객의 예산과 상황에 맞춰 최대한의 디자인 결과물을 내려고 노력하는 편이십니다.",
          "작업을 진행한 고객평 : \"적은 예산이지만 실장님과 진행하니 만족스러워요.\""
        ]
      },
      {
        "desid": "d2105_aa02s",
        "fee": [
          {
            "method": "offline",
            "partial": false,
            "amount": 3150000,
            "distance": {
              "number": 0,
              "amount": 0,
              "distance": "0km",
              "time": "0시간 0분",
              "limit": 5
            },
            "discount": 0
          }
        ],
        "pictureSettings": [
          {
            "position": "0",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "width: 66.5%; height: 66%; top: 0%; left: 0%; background-image: url(\"/corePortfolio/forecast/p197/photo28.jpg\");",
            "imgSrc": "/corePortfolio/forecast/p197/photo28.jpg"
          },
          {
            "position": "1",
            "sgTrue": "s",
            "unionPo": "right",
            "styleText": "width: 32.8%; height: 66%; top: 0%; left: 67.2%; background-image: url(\"/corePortfolio/listImage/p143/t2p143.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p143/t2p143.jpg"
          },
          {
            "position": "2",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "top: 67%; left: 0%; width: 32.8%; height: 33%; background-image: url(\"/corePortfolio/forecast/p197/photo35.jpg\");",
            "imgSrc": "/corePortfolio/forecast/p197/photo35.jpg"
          },
          {
            "position": "3",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "top: 67%; left: 33.5%; width: 33%; height: 33%; background-image: url(\"/rawDesigner/ghost/d2105_aa02s/g2.jpg\");",
            "imgSrc": "/rawDesigner/ghost/d2105_aa02s/g2.jpg"
          },
          {
            "position": "4",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "top: 67%; left: 67.2%; width: 32.8%; height: 33%; background-image: url(\"/rawDesigner/ghost/d2105_aa02s/g14.jpg\");",
            "imgSrc": "/rawDesigner/ghost/d2105_aa02s/g14.jpg"
          }
        ],
        "description": [
          "고객님의 스타일에 잘 맞추어 조정하며, 서로간 예의를 지키는 가치를 중요시 합니다.",
          "화려함보다는 질리지 않는 뉴트럴 톤의 공간 스타일을 지향합니다.",
          "집이 단순한 휴식 공간을 넘어 나를 표현하는 곳이 될 수 있도록 만들어 드립니다."
        ]
      },
      {
        "desid": "d2004_aa01s",
        "fee": [
          {
            "method": "offline",
            "partial": false,
            "amount": 3021000,
            "distance": {
              "number": 0,
              "amount": 0,
              "distance": "0km",
              "time": "0시간 0분",
              "limit": 5
            },
            "discount": 0
          }
        ],
        "pictureSettings": [
          {
            "position": "0",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "width: 66.5%; height: 66%; top: 0%; left: 0%; background-image: url(\"/corePortfolio/listImage/p117/t2p117.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p117/t2p117.jpg"
          },
          {
            "position": "1",
            "sgTrue": "s",
            "unionPo": "right",
            "styleText": "width: 32.8%; height: 66%; top: 0%; left: 67.2%; background-image: url(\"/corePortfolio/listImage/p119/t20p119.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p119/t20p119.jpg"
          },
          {
            "position": "2",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "width: 32.8%; height: 33%; top: 67%; left: 0%; background-image: url(\"/corePortfolio/listImage/p150/t6p150.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p150/t6p150.jpg"
          },
          {
            "position": "3",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "top: 67%; left: 33.5%; width: 33%; height: 33%; background-image: url(\"/corePortfolio/listImage/p119/t15p119.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p119/t15p119.jpg"
          },
          {
            "position": "4",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "width: 32.8%; height: 33%; top: 67%; left: 67.2%; background-image: url(\"/corePortfolio/listImage/p119/t7p119.jpg\");",
            "imgSrc": "/corePortfolio/listImage/p119/t7p119.jpg"
          }
        ],
        "description": [
          "내추럴한 스타일링에 강점이 있고, 스튜디오 타입 혹은 독창적인 니즈에 꼭 맞는 스타일링에 능합니다.",
          "고객의 요청 사항에 대해서 세심하게 반응하며 디자인합니다.",
          "작업을 진행한 고객평 : \"책임감있게 제안해주셔서 의견 조정시 믿고 따라갈 수 있었습니다.\""
        ]
      },
      {
        "desid": "d2201_aa02s",
        "fee": [
          {
            "method": "offline",
            "partial": false,
            "amount": 2725000,
            "distance": {
              "number": 0,
              "amount": 0,
              "distance": "0km",
              "time": "0시간 0분",
              "limit": 5
            },
            "discount": 0
          }
        ],
        "pictureSettings": [
          {
            "position": "0",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "width: 66.5%; height: 66%; top: 0%; left: 0%; background-image: url(\"/rawDesigner/ghost/d2201_aa02s/g15.jpg\");",
            "imgSrc": "/rawDesigner/ghost/d2201_aa02s/g15.jpg"
          },
          {
            "position": "1",
            "sgTrue": "s",
            "unionPo": "right",
            "styleText": "width: 32.8%; height: 66%; top: 0%; left: 67.2%; background-image: url(\"/rawDesigner/ghost/d2201_aa02s/g12.jpg\");",
            "imgSrc": "/rawDesigner/ghost/d2201_aa02s/g12.jpg"
          },
          {
            "position": "2",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "top: 67%; left: 0%; width: 32.8%; height: 33%; background-image: url(\"/rawDesigner/ghost/d2201_aa02s/g14.jpg\");",
            "imgSrc": "/rawDesigner/ghost/d2201_aa02s/g14.jpg"
          },
          {
            "position": "3",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "top: 67%; left: 33.5%; width: 33%; height: 33%; background-image: url(\"/rawDesigner/ghost/d2201_aa02s/g10.jpg\");",
            "imgSrc": "/rawDesigner/ghost/d2201_aa02s/g10.jpg"
          },
          {
            "position": "4",
            "sgTrue": "g",
            "unionPo": "union",
            "styleText": "top: 67%; left: 67.2%; width: 32.8%; height: 33%; background-image: url(\"/rawDesigner/ghost/d2201_aa02s/g9.jpg\");",
            "imgSrc": "/rawDesigner/ghost/d2201_aa02s/g9.jpg"
          }
        ],
        "description": [
          "미팅 전에 준비한 라이프스타일 체크지를 통해 생활 습간들을 전판적으로 파악합니다.",
          "고객님만의 드림 하우스, 고객님만의 낭만적인 공간 요소를 찾아보려 노력합니다.",
          "고객님을 잘 표현할 수 있는 컬러, 무드, 소재, 브랜드를 고려하고 제안합니다."
        ]
      }
    ]
  },
  "process": {
    "status": "완료",
    "action": "촬영 컨택",
    "detail": [],
    "outreason": [],
    "call": {
      "next": new Date(1800, 0, 1),
      "history": []
    },
    "contract": {
      "first": {
        "guide": new Date(1800, 0, 1),
        "date": new Date(1800, 0, 1),
        "cancel": new Date(1800, 0, 1),
        "calculation": {
          "amount": 330000,
          "info": {
            "method": "카드(롯데)",
            "proof": "이니시스",
            "to": "이민희"
          },
          "refund": 0
        }
      },
      "remain": {
        "guide": new Date(1800, 0, 1),
        "date": new Date("2022-05-10T02:16:52.867Z"),
        "cancel": new Date(1800, 0, 1),
        "calculation": {
          "amount": {
            "supply": 3150000,
            "vat": 315000,
            "consumer": 3465000
          },
          "info": {
            "method": "카드(롯데)",
            "proof": "이니시스",
            "to": "이민희"
          },
          "refund": 0,
          "discount": 0
        }
      },
      "form": {
        "id": "6279cab19fc128b671e0afee",
        "guide": new Date(1800, 0, 1),
        "date": {
          "from": new Date("2022-06-14T15:00:00.000Z"),
          "to": new Date("2022-08-14T15:00:00.000Z"),
          "cancel": new Date(1800, 0, 1),
        }
      },
      "meeting": {
        "date": new Date("2022-05-09T03:30:00.000Z"),
        "pastDesigners": []
      }
    },
    "design": {
      "proposal": {
        "provided": false,
        "limit": null,
        "detail": []
      },
      "construct": {
        "status": "완료",
        "request": new Date("2022-06-15T15:00:00.000Z"),
        "estimate": [
          {
            "invid": null,
            "date": new Date("2022-07-17T15:00:00.000Z"),
          }
        ],
        "contract": {
          "partner": "김상우_규빗디자인웍스",
          "form": {
            "id": "62da5f1f5a0db2004b8fdfbf",
            "guide": new Date("2022-07-22T08:26:05.332Z"),
            "date": {
              "from": new Date("2022-07-24T15:00:00.000Z"),
              "to": new Date("2022-08-01T15:00:00.000Z"),
              "cancel": new Date(1800, 0, 1),
            }
          },
          "payments": {
            "first": {
              "guide": new Date("2022-07-22T08:26:08.556Z"),
              "date": new Date("2022-07-22T08:28:26.619Z"),
              "cancel": new Date(1800, 0, 1),
              "calculation": {
                "amount": {
                  "supply": 642728,
                  "vat": 64272,
                  "consumer": 707000
                },
                "info": {
                  "method": "계좌 이체",
                  "proof": "현금 영수증",
                  "to": "이민희"
                },
                "refund": 0
              }
            },
            "start": {
              "guide": new Date("2022-07-26T04:57:16.858Z"),
              "date": new Date("2022-07-26T05:10:35.142Z"),
              "cancel": new Date(1800, 0, 1),
              "calculation": {
                "amount": {
                  "supply": 2570910,
                  "vat": 257090,
                  "consumer": 2828000
                },
                "info": {
                  "method": "계좌 이체",
                  "proof": "현금 영수증",
                  "to": "이민희"
                },
                "refund": 0
              }
            },
            "middle": {
              "guide": new Date("2022-07-28T05:28:10.718Z"),
              "date": new Date("2022-07-30T15:45:47.658Z"),
              "cancel": new Date(1800, 0, 1),
              "calculation": {
                "amount": {
                  "supply": 2570910,
                  "vat": 257090,
                  "consumer": 2828000
                },
                "info": {
                  "method": "계좌 이체",
                  "proof": "현금 영수증",
                  "to": "이민희"
                },
                "refund": 0
              }
            },
            "remain": {
              "guide": new Date("2022-08-03T02:37:08.287Z"),
              "date": new Date("2022-08-03T02:52:06.077Z"),
              "cancel": new Date(1800, 0, 1),
              "calculation": {
                "amount": {
                  "supply": 470000,
                  "vat": 47000,
                  "consumer": 517000
                },
                "info": {
                  "method": "계좌 이체",
                  "proof": "현금 영수증",
                  "to": "이민희"
                },
                "refund": 0
              }
            }
          },
          "after": {
            "expired": new Date(1800, 0, 1),
            "history": []
          }
        }
      },
      "purchase": {
        "provided": false,
        "detail": []
      }
    },
    "calculation": {
      "method": "사업자(간이)",
      "percentage": 30,
      "info": {
        "account": "우리은행 1005-704-310314",
        "proof": "박주령",
        "to": "박주령"
      },
      "payments": {
        "totalAmount": 2205000,
        "first": {
          "amount": 1102500,
          "date": new Date("2022-05-22T15:00:00.000Z"),
          "cancel": new Date(1800, 0, 1),
          "refund": 0
        },
        "remain": {
          "amount": 1102500,
          "date": new Date("2022-09-25T15:00:00.000Z"),
          "cancel": new Date(1800, 0, 1),
          "refund": 0
        }
      }
    }
  },
  "contents": {
    "conid": "",
    "photo": {
      "boo": true,
      "status": "촬영 완료",
      "date": new Date("2022-09-20T02:00:00.000Z"),
      "info": {
        "photographer": "정경일",
        "interviewer": "김지은"
      }
    },
    "raw": {
      "portfolio": {
        "status": "원본 수집 완료",
        "link": "https://drive.google.com/file/d/1NUAzCa80Zz2nESM_tpQc4YHTJ5mrjRdQ/view?uspsharing"
      },
      "interview": {
        "status": "해당 없음",
        "link": ""
      },
      "photo": {
        "status": "원본 보정 완료",
        "link": ""
      }
    },
    "share": {
      "client": {
        "photo": new Date("2022-09-20T11:19:26.986Z"),
        "contents": new Date("2022-12-02T06:49:02.585Z"),
      },
      "designer": {
        "photo": new Date("2022-09-20T11:19:26.986Z"),
        "contents": new Date("2022-12-02T06:49:02.585Z"),
      }
    },
    "sns": {
      "portfolio": {
        "long": new Date("3799-12-31T15:00:00.000Z"),
        "short": new Date(1800, 0, 1),
      },
      "interview": {
        "long": new Date("2022-12-01T15:00:00.000Z"),
        "short": new Date(-5364692872000),
      }
    },
    "payment": {
      "status": "결제 완료",
      "date": new Date("2022-09-20T02:00:00.000Z"),
      "cancel": new Date(1800, 0, 1),
      "calculation": {
        "amount": 165000,
        "info": {
          "method": "계좌 이체",
          "proof": "현금영수증",
          "to": "박주령"
        },
        "refund": 0
      }
    }
  }
}

const ProjectMap = {
  main: function () {
    let dummy;
    dummy = {
      structure: {
        proid: "",
        cliid: "",
        desid: "",
        service: {
          serid: "",
          xValue: "",
          online: false,
        },
        proposal: {
          status: "",
          date: new Date(1800, 0, 1),
          detail: [],
        },
        process: {
          status: "대기",
          action: "계약금 안내",
          detail: [],
          outreason: [],
          call: {
            next: new Date(1800, 0, 1),
            history: [],
          },
          contract: {
            first: {
              guide: new Date(1800, 0, 1),
              date: new Date(1800, 0, 1),
              cancel: new Date(1800, 0, 1),
              calculation: {
                amount: 0,
                info: {
                  method: "",
                  proof: "",
                  to: "",
                },
                refund: 0,
              },
            },
            remain: {
              guide: new Date(1800, 0, 1),
              date: new Date(1800, 0, 1),
              cancel: new Date(1800, 0, 1),
              calculation: {
                amount: {
                  supply: 0,
                  vat: 0,
                  consumer: 0,
                },
                info: {
                  method: "",
                  proof: "",
                  to: "",
                },
                refund: 0,
                discount: 0,
              },
            },
            form: {
              id: "",
              guide: new Date(1800, 0, 1),
              date: {
                from: new Date(1800, 0, 1),
                to: new Date(1800, 0, 1),
                cancel: new Date(1800, 0, 1),
              }
            },
            meeting: {
              date: new Date(1800, 0, 1),
              pastDesigners: []
            },
          },
          design: {
            proposal: {
              provided: false,
              limit: null,
              detail: []
            },
            construct: null,
            purchase: {
              provided: false,
              detail: [],
            },
          },
          calculation: {
            method: "",
            percentage: 0,
            info: {
              account: "",
              proof: "",
              to: "",
            },
            payments: {
              totalAmount: 0,
              first: {
                amount: 0,
                date: new Date(1800, 0, 1),
                cancel: new Date(1800, 0, 1),
                refund: 0,
              },
              remain: {
                amount: 0,
                date: new Date(1800, 0, 1),
                cancel: new Date(1800, 0, 1),
                refund: 0,
              }
            }
          },
        },
        contents: {
          conid: "",
          photo: {
            boo: true,
            status: "세팅 대기",
            date: new Date(3800, 0, 1),
            info: {
              photographer: "미정",
              interviewer: "미정",
            }
          },
          payment: {
            status: "결제 대기",
            date: new Date(1800, 0, 1),
            cancel: new Date(1800, 0, 1),
            calculation: {
              amount: 165000,
              info: {
                method: "",
                proof: "",
                to: "",
              },
              refund: 0,
            },
          },
          raw: {
            portfolio: {
              status: "해당 없음",
              link: "",
            },
            interview: {
              status: "해당 없음",
              link: "",
            },
            photo: {
              status: "해당 없음",
              link: "",
            },
          },
          share: {
            client: {
              photo: new Date(3800, 0, 1),
              contents: new Date(3800, 0, 1),
            },
            designer: {
              photo: new Date(3800, 0, 1),
              contents: new Date(3800, 0, 1),
            }
          },
          sns: {
            portfolio: {
              long: new Date(3800, 0, 1),
              short: new Date(3800, 0, 1),
            },
            interview: {
              long: new Date(3800, 0, 1),
              short: new Date(3800, 0, 1),
            },
          }
        },
      }
    };
    return dummy;
  },
  sub: function (subject) {
    let dummy = null;
    if (subject === "process.call.history") {
      dummy = {
        date: new Date(1800, 0, 1),
        who: "",
      };
    } else if (subject === "process.contract.meeting.pastDesigners") {
      dummy = {
        date: new Date(1800, 0, 1),
        desid: "",
      };
    } else if (subject === "process.design.construct") {
      dummy = {
        status: "대기",
        request: new Date(1800, 0, 1),
        estimate: [],
        contract: {
          partner: "",
          form: {
            id: "",
            guide: new Date(1800, 0, 1),
            date: {
              from: new Date(1800, 0, 1),
              to: new Date(1800, 0, 1),
              cancel: new Date(1800, 0, 1),
            }
          },
          payments: {
            first: null,
            start: null,
            middle: null,
            remain: null
          },
          after: {
            expired: new Date(1800, 0, 1),
            history: [],
          }
        }
      };
    } else if (subject === "process.design.construct.estimate") {
      dummy = {
        invid: "",
        date: new Date(1800, 0, 1),
      };
    } else if (subject === "process.design.construct.contract.after.history") {
      dummy = {
        from: new Date(1800, 0, 1),
        to: new Date(1800, 0, 1),
        amount: 0,
      };
    } else if (subject === "process.design.construct.contract.payments") {
      dummy = {
        guide: new Date(1800, 0, 1),
        date: new Date(1800, 0, 1),
        cancel: new Date(1800, 0, 1),
        calculation: {
          amount: {
            supply: 0,
            vat: 0,
            consumer: 0,
          },
          info: {
            method: "",
            proof: "",
            to: "",
          },
          refund: 0,
        },
      };
    }
    return dummy;
  }
}

/**
 * @class DateParse
 * Date 클래스를 확장하여 날짜 처리 기능을 제공하는 클래스입니다.
 * 문자열 형식의 날짜를 Date 객체로 변환하거나, Date 객체를 다양한 형식으로 변환할 수 있습니다.
 */
class DateParse extends Date {

  /**
   * @constructor
   * 주어진 dateObject를 Date 객체로 변환하여 초기화합니다.
   * 문자열 형식의 날짜가 주어진 경우, 해당 문자열을 분석하여 Date 객체로 변환합니다.
   * @param {string|Date} dateObject - 변환할 날짜 문자열 또는 Date 객체
   * @throws {Error} 유효하지 않은 날짜 형식이 주어진 경우 예외를 발생시킵니다.
   */
  constructor(dateObject) {
    // 임시 배열 변수를 선언합니다.
    let tempArr0, tempArr1, tempArr2;

    // dateObject가 문자열인 경우
    if (typeof dateObject === "string") {
      // 날짜 문자열이 "YYYY-MM-DD HH:MM:SS" 형식인 경우
      if (dateObject.length === 19) {
        // 날짜와 시간을 분리하여 tempArr0에 저장합니다.
        tempArr0 = dateObject.split(" ");
        // 날짜 부분을 "-"로 분리하여 tempArr1에 저장합니다.
        tempArr1 = tempArr0[0].split("-");
        // 시간 부분을 ":"로 분리하여 tempArr2에 저장합니다.
        tempArr2 = tempArr0[1].split(":");
        // 분리된 연, 월, 일, 시, 분, 초 정보를 이용해 Date 객체를 생성하고, 상위 클래스(Date)의 생성자를 호출합니다.
        super(new Date(
          Number(tempArr1[0]), 
          Number(tempArr1[1]) - 1, 
          Number(tempArr1[2]), 
          Number(tempArr2[0]), 
          Number(tempArr2[1]), 
          Number(tempArr2[2])
        ));
      } 
      // 날짜 문자열이 "YYYY-MM-DD" 형식인 경우
      else if (dateObject.length === 10) {
        // 날짜를 "-"로 분리하여 tempArr1에 저장합니다.
        tempArr1 = dateObject.split("-");
        // 분리된 연, 월, 일 정보를 이용해 Date 객체를 생성하고, 상위 클래스(Date)의 생성자를 호출합니다.
        super(new Date(
          Number(tempArr1[0]), 
          Number(tempArr1[1]) - 1, 
          Number(tempArr1[2])
        ));
      } 
      // 유효하지 않은 날짜 형식인 경우
      else {
        // 예외를 발생시킵니다.
        throw new Error("invalid date object");
      }
    } 
    // dateObject가 문자열이 아닌 경우
    else {
      // dateObject를 ISO 문자열로 변환한 후 Date 객체로 초기화합니다.
      super(dateObject.toISOString());
    }
  }

  /**
   * @method zeroAddition
   * 숫자가 10보다 작은 경우 앞에 0을 추가하여 2자리 문자열로 반환합니다.
   * @param {number} number - 2자리로 변환할 숫자
   * @returns {string} 2자리 숫자 문자열
   */
  static zeroAddition(number) {
    // 숫자가 10보다 큰 경우 그대로 문자열로 반환합니다.
    if (number > 9) {
      return String(number);
    } 
    // 숫자가 10보다 작은 경우 앞에 0을 추가하여 문자열로 반환합니다.
    else {
      return '0' + String(number);
    }
  }

  /**
   * @method toString
   * Date 객체를 "YYYY-MM-DD" 또는 "YYYY-MM-DD HH:MM:SS" 형식의 문자열로 변환합니다.
   * @param {boolean} [detail=false] - 시간 정보까지 포함할지 여부
   * @returns {string} 변환된 날짜 문자열
   */
  toString(detail = false) {
    // 연도, 월, 일, 시, 분, 초 정보를 각각 추출합니다.
    const year = this.getFullYear();
    const month = this.getMonth() + 1;
    const day = this.getDate();
    const hours = this.getHours();
    const minutes = this.getMinutes();
    const seconds = this.getSeconds();

    // detail이 true인 경우 "YYYY-MM-DD HH:MM:SS" 형식으로 변환합니다.
    if (detail) {
      // 연도가 1800년인 경우 "1800-01-01"로 반환합니다.
      if (year === 1800) {
        return "1800-01-01";
      } 
      // 그렇지 않으면 연, 월, 일, 시, 분, 초를 모두 포함한 문자열을 반환합니다.
      else {
        return (
          DateParse.zeroAddition(year) + "-" + 
          DateParse.zeroAddition(month) + "-" + 
          DateParse.zeroAddition(day) + " " + 
          DateParse.zeroAddition(hours) + ":" + 
          DateParse.zeroAddition(minutes) + ":" + 
          DateParse.zeroAddition(seconds)
        );
      }
    } 
    // detail이 false인 경우 "YYYY-MM-DD" 형식으로 변환합니다.
    else {
      // 연도가 1800년인 경우 "1800-01-01"로 반환합니다.
      if (year === 1800) {
        return "1800-01-01";
      } 
      // 그렇지 않으면 연, 월, 일만 포함한 문자열을 반환합니다.
      else {
        return (
          DateParse.zeroAddition(year) + "-" + 
          DateParse.zeroAddition(month) + "-" + 
          DateParse.zeroAddition(day)
        );
      }
    }
  }

  /**
   * @method toNormal
   * DateParse 객체를 일반 Date 객체로 변환합니다.
   * @returns {Date} 변환된 Date 객체
   */
  toNormal() {
    // 현재 객체의 ISO 문자열 표현을 사용하여 새로운 Date 객체를 반환합니다.
    return new Date(this.toISOString());
  }

  /**
   * @method toSixString
   * Date 객체를 "YYMMDD" 형식의 6자리 문자열로 변환합니다.
   * @returns {string} 변환된 6자리 날짜 문자열
   */
  toSixString() {
    // 날짜를 "YYYY-MM-DD" 형식의 문자열로 변환한 후, 앞 두 자리를 제외한 "YYMMDD" 형식으로 잘라서 반환합니다.
    let date = this.toString(false);
    return (date.slice(2, 4) + date.slice(5, 7) + date.slice(8, 10));
  }

}

class Menu extends String {

  constructor (value, items, multiple = false) {
    if (Array.isArray(value)) {
      super('');
    } else {
      super(value);
    }
    this.value = null;
    this.values = null;
    this.items = items;
    let temp;
    if (!multiple) {
      if (items.includes(value)) {
        this.value = value;
      } else {
        this.value = "알 수 없음";
      }
    } else {
      temp = [];
      for (let i of value) {
        if (items.includes(i)) {
          temp.push(i);
        }
      }
      this.values = temp;
    }
  }

  toNormal () {
    if (this.values === null) {
      return this.value;
    } else {
      return this.values;
    }
  }
  
}

class Project {
  constructor(json) {
    this.proid = json.proid;
    this.cliid = json.cliid;
    this.desid = json.desid;
    this.service = new this.#ProjectService(json.service);
    this.proposal = new this.#ProjectProposal(json.proposal);
    this.process = new this.#ProjectProcess(json.process);
    this.contents = new this.#ProjectContents(json.contents);
  }

  toNormal() {
    return {
      proid: this.proid,
      cliid: this.cliid,
      desid: this.desid,
      service: this.service.toNormal(),
      proposal: this.proposal.toNormal(),
      process: this.process.toNormal(),
      contents: this.contents.toNormal()
    };
  }

  #ProjectProposal = class {
    constructor(json) {
      this.status = json.status;
      this.date = new DateParse(json.date);
      this.detail = new this.#Proposals();
      for (let i of json.detail) {
        const tempInstance = new this.#Proposal(i);
        this.detail.push(tempInstance);
      }
    }
  
    toNormal() {
      return {
        status: this.status,
        date: this.date.toNormal(),
        detail: this.detail.toNormal(),
      };
    }
  
    #Proposals = class extends Array {
      toNormal() {
        let arr = [];
        for (let i of this) {
          arr.push(i.toNormal());
        }
        return arr;
      }
    }
    
    #Proposal = class {
      constructor(json) {
        this.desid = json.desid;
        this.fee = new this.#Fees();
        for (let i of json.fee) {
          const tempInstance0 = new this.#Fee(i);
          this.fee.push(tempInstance0);
        }
        this.pictureSettings = new this.#PictureSettings();
        for (let i of json.pictureSettings) {
          const tempInstance1 = new this.#PictureSetting(i);
          this.pictureSettings.push(tempInstance1);
        }
        this.description = new this.#Description();
        for (let i of json.description) {
          this.description.push(i);
        }
      }
    
      #Fees = class extends Array {
        toNormal() {
          let arr = [];
          for (let i of this) {
            arr.push(i.toNormal());
          }
          return arr;
        }
        reset() {
          if (this.length > 0) {
            this.splice(0, this.length);
          }
        }
      }
      
      #Fee = class {
        constructor(json) {
          this.method = json.method;
          this.partial = json.partial;
          this.amount = json.amount;
          this.discount = json.discount;
          this.distance = new this.#FeeDistance(json.distance);
        }
      
        toNormal() {
          return {
            method: this.method,
            partial: this.partial,
            amount: this.amount,
            discount: this.discount,
            distance: this.distance.toNormal()
          };
        }
      
        #FeeDistance = class {
          constructor(json) {
            this.number = json.number;
            this.amount = json.amount;
            this.distance = json.distance;
            this.time = json.time;
            this.limit = json.limit;
          }
        
          toNormal() {
            return {
              number: this.number,
              amount: this.amount,
              distance: this.distance,
              time: this.time,
              limit: this.limit
            };
          }
        }
      }
      
      #PictureSettings = class extends Array {
        toNormal() {
          let arr = [];
          for (let i of this) {
            arr.push(i.toNormal());
          }
          return arr;
        }
      }
      
      #PictureSetting = class {
        constructor(json) {
          this.position = json.position;
          this.sgTrue = json.sgTrue;
          this.unionPo = json.unionPo;
          this.styleText = json.styleText;
          this.imgSrc = json.imgSrc;
        }
      
        toNormal() {
          return {
            position: this.position,
            sgTrue: this.sgTrue,
            unionPo: this.unionPo,
            styleText: this.styleText,
            imgSrc: this.imgSrc
          };
        }
      }
      
      #Description = class extends Array {
        toNormal() {
          let arr = [];
          for (let i of this) {
            arr.push(i);
          }
          return arr;
        }
      }
    
      toNormal() {
        return {
          desid: this.desid,
          fee: this.fee.toNormal(),
          pictureSettings: this.pictureSettings.toNormal(),
          description: this.description.toNormal(),
        };
      }
    
      resetFee() {
        this.fee.reset();
      }
    
      appendFee(method, amount, number = 0, distanceAmount = 0, km = "0km", time = "0시간 0분") {
        if (typeof method !== "string" || typeof amount !== "number") {
          throw new Error("invalid input");
        }
        const tempInstance = new Fee({
          method: (/off/gi.test(method) ? "offline" : "online"),
          partial: false,
          amount: amount,
          discount: 0,
          distance: {
            number: number,
            amount: distanceAmount,
            distance: km,
            time: time,
            limit: 5,
          },
        });
        this.fee.push(tempInstance);
      }
    }
  }
  
  #ProjectContents = class {
    constructor (json) {
      this.conid = json.conid;
      this.photo = new this.#ContentsPhoto(json.photo);
      this.payment = new this.#ContentsPayment(json.payment);
      this.raw = new this.#ContentsRaw(json.raw);
      this.share = new this.#ContentsShare(json.share);
      this.sns = new this.#ContentsSns(json.sns);
    }
  
    toNormal () {
      let obj = {};
      obj.conid = this.conid;
      obj.photo = this.photo.toNormal();
      obj.payment = this.payment.toNormal();
      obj.raw = this.raw.toNormal();
      obj.share = this.share.toNormal();
      obj.sns = this.sns.toNormal();
      return obj;
    }
  
    #ContentsPayment = class {
      constructor(json) {
        this.status = new Menu(json.status, [
          '결제 대기',
          '결제 완료',
          '무료 촬영',
          '환불 완료',
          '해당 없음'
        ], false);
        this.date = new DateParse(json.date);
        this.cancel = new DateParse(json.cancel);
        this.calculation = new this.#ContentsPaymentCalculation(json.calculation);
      }
    
      toNormal() {
        return {
          status: this.status.toNormal(),
          date: this.date.toNormal(),
          cancel: this.cancel.toNormal(),
          calculation: this.calculation.toNormal()
        };
      }
    
      #ContentsPaymentCalculation = class {
        constructor(json) {
          this.amount = json.amount;
          this.info = new this.#ContentsPaymentCalculationInfo(json.info);
          this.refund = json.refund;
        }
        toNormal() {
          return {
            amount: this.amount,
            info: this.info.toNormal(),
            refund: this.refund
          };
        }
        #ContentsPaymentCalculationInfo = class {
          constructor(json) {
            this.method = json.method;
            this.proof = json.proof;
            this.to = json.to;
          }
        
          toNormal() {
            return {
              method: this.method,
              proof: this.proof,
              to: this.to
            };
          }
        }
      }
    }
  
    #ContentsSns = class {
      constructor(json) {
        this.portfolio = new this.#ContentsSnsPortfolio(json.portfolio);
        this.interview = new this.#ContentsSnsInterview(json.interview);
      }
    
      toNormal() {
        return {
          portfolio: this.portfolio.toNormal(),
          interview: this.interview.toNormal()
        };
      }
    
      #ContentsSnsInterview = class {
        constructor(json) {
          this.long = new DateParse(json.long);
          this.short = new DateParse(json.short);
        }
      
        toNormal() {
          return {
            long: this.long.toNormal(),
            short: this.short.toNormal()
          };
        }
      }
      
      #ContentsSnsPortfolio = class {
        constructor(json) {
          this.long = new DateParse(json.long);
          this.short = new DateParse(json.short);
        }
      
        toNormal() {
          return {
            long: this.long.toNormal(),
            short: this.short.toNormal()
          };
        }
      }
    }
  
    #ContentsPhoto = class {
      constructor(json) {
        this.boo = json.boo;
        this.status = new Menu(json.status, [
          '세팅 대기',
          '촬영 컨택 요망',
          '촬영 컨택중',
          '촬영 일정 확정',
          '촬영 완료',
          '촬영 홀딩',
          '해당 없음'
        ], false);
        this.date = new DateParse(json.date);
        this.info = new this.#ContentsPhotoInfo(json.info);
      }
    
      toNormal() {
        return {
          boo: this.boo,
          status: this.status.toNormal(),
          date: this.date.toNormal(),
          info: this.info.toNormal()
        };
      }
    
      #ContentsPhotoInfo = class {
        constructor(json) {
          this.photographer = json.photographer;
          this.interviewer = json.interviewer;
        }
      
        toNormal() {
          return {
            photographer: this.photographer,
            interviewer: this.interviewer
          };
        }
      }
    }
  
    #ContentsShare = class {
      constructor(json) {
        this.client = new this.#ContentsShareClient(json.client);
        this.designer = new this.#ContentsShareDesigner(json.designer);
      }
    
      toNormal() {
        return {
          client: this.client.toNormal(),
          designer: this.designer.toNormal()
        };
      }
    
      #ContentsShareDesigner = class {
        constructor(json) {
          this.photo = new DateParse(json.photo);
          this.contents = new DateParse(json.contents);
        }
      
        toNormal() {
          return {
            photo: this.photo.toNormal(),
            contents: this.contents.toNormal()
          };
        }
      }
      
      #ContentsShareClient = class {
        constructor(json) {
          this.photo = new DateParse(json.photo);
          this.contents = new DateParse(json.contents);
        }
      
        toNormal() {
          return {
            photo: this.photo.toNormal(),
            contents: this.contents.toNormal()
          };
        }
      }
    }
    
    #ContentsRaw = class {
      constructor(json) {
        this.portfolio = new this.#ContentsRawPortfolio(json.portfolio);
        this.interview = new this.#ContentsRawInterview(json.interview);
        this.photo = new this.#ContentsRawPhoto(json.photo);
      }
    
      toNormal() {
        return {
          portfolio: this.portfolio.toNormal(),
          interview: this.interview.toNormal(),
          photo: this.photo.toNormal()
        };
      }
    
      #ContentsRawPhoto = class {
        constructor(json) {
          this.status = new Menu(json.status, [
            '촬영 대기',
            '원본 요청 요망',
            '원본 요청 완료',
            '원본 수집 완료',
            '원본 보정중',
            '원본 보정 완료',
            '해당 없음'
          ], false);
          this.link = json.link;
        }
      
        toNormal() {
          return {
            status: this.status.toNormal(),
            link: this.link
          };
        }
      }
      
      #ContentsRawInterview = class {
        constructor(json) {
          this.status = new Menu(json.status, [
            '세팅 대기',
            '인터뷰 요망',
            '인터뷰 완료',
            '원본 편집중',
            '원본 편집 완료',
            '해당 없음'
          ], false);
          this.link = json.link;
        }
      
        toNormal() {
          return {
            status: this.status.toNormal(),
            link: this.link
          };
        }
      }
      
      #ContentsRawPortfolio = class {
        constructor(json) {
          this.status = new Menu(json.status, [
            '세팅 대기',
            '원본 요청 요망',
            '원본 요청 완료',
            '원본 수집 완료',
            '원본 편집중',
            '원본 편집 완료',
            '해당 없음'
          ], false);
          this.link = json.link;
        }
      
        toNormal() {
          return {
            status: this.status.toNormal(),
            link: this.link
          };
        }
      }
    }
  }
  
  #ProjectService = class {
    constructor(json) {
      this.serid = json.serid;
      this.xValue = json.xValue;
      this.online = Boolean(json.online);
    }
  
    toNormal() {
      return {
        serid: this.serid,
        xValue: this.xValue,
        online: this.online
      };
    }
  }
  
  #ProjectProcess = class {
    constructor(json) {
      this.status = new Menu(json.status, [
        "대기",
        "진행중",
        "완료",
        "홀딩",
        "드랍"
      ], false);
      this.action = new Menu(json.action, [
        "계약금 안내",
        "현장미팅 조율",
        "현장미팅 확정",
        "의뢰서 공유",
        "현장미팅 피드백",
        "잔금 안내",
        "시작 대기",
        "1차 제안",
        "수정 제안",
        "시공 진행",
        "제품 구매",
        "추가 제안",
        "배송중",
        "세팅 마무리",
        "촬영 컨택",
        "사진 업로드",
        "디자이너글 업로드",
        "증빙 처리",
        "정산 대기",
        "프로젝트 완료",
        "해당 없음"
      ], false);
      this.outreason = new Menu(json.outreason, [
        "연결 안 됨",
        "가벼운 문의",
        "타사 계약",
        "비용 문제",
        "의견 조정 안 됨",
        "직접 진행",
      ], true);
      this.detail = new this.#ProcessDetails(json.detail);
      this.call = new this.#ProcessCall(json.call);
      this.contract = new this.#Contract(json.contract);
      this.design = new this.#Design(json.design);
      this.calculation = new this.#Calculation(json.calculation);
    }
  
    toNormal() {
      return {
        status: this.status.toNormal(),
        action: this.action.toNormal(),
        outreason: this.outreason.toNormal(),
        detail: this.detail.toNormal(),
        call: this.call.toNormal(),
        contract: this.contract.toNormal(),
        design: this.design.toNormal(),
        calculation: this.calculation.toNormal(),
      };
    }
  
    #Contract = class {
      constructor(json) {
        this.first = new this.#First(json.first);
        this.remain = new this.#Remain(json.remain);
        this.form = new this.#Form(json.form);
        this.meeting = new this.#Meeting(json.meeting);
      }
    
      toNormal() {
        return {
          first: this.first.toNormal(),
          remain: this.remain.toNormal(),
          form: this.form.toNormal(),
          meeting: this.meeting.toNormal(),
        };
      }
    
      #First = class {
        constructor(json) {
          this.guide = new DateParse(json.guide);
          this.date = new DateParse(json.date);
          this.cancel = new DateParse(json.cancel);
          this.calculation = new this.#FirstCalculation(json.calculation);
        }
      
        toNormal() {
          return {
            guide: this.guide.toNormal(),
            date: this.date.toNormal(),
            cancel: this.cancel.toNormal(),
            calculation: this.calculation.toNormal(),
          };
        }
      
        #FirstCalculation = class {
          constructor(json) {
            this.amount = json.amount;
            this.info = new this.#FirstCalculationInfo(json.info);
            this.refund = json.refund;
          }
        
          toNormal() {
            return {
              amount: this.amount,
              info: this.info.toNormal(),
              refund: this.refund,
            };
          }
        
          #FirstCalculationInfo = class {
            constructor(json) {
              this.method = json.method;
              this.proof = json.proof;
              this.to = json.to;
            }
          
            toNormal() {
              return {
                method: this.method,
                proof: this.proof,
                to: this.to,
              };
            }
          }
        }
      }
      
      #Remain = class {
        constructor(json) {
          this.guide = new DateParse(json.guide);
          this.date = new DateParse(json.date);
          this.cancel = new DateParse(json.cancel);
          this.calculation = new this.#RemainCalculation(json.calculation);
        }
      
        toNormal() {
          return {
            guide: this.guide.toNormal(),
            date: this.date.toNormal(),
            cancel: this.cancel.toNormal(),
            calculation: this.calculation.toNormal(),
          };
        }
      
        #RemainCalculation = class {
          constructor(json) {
            this.amount = new this.#RemainCalculationAmount(json.amount);
            this.info = new this.#RemainCalculationInfo(json.info);
            this.refund = json.refund;
            this.discount = json.discount;
          }
        
          toNormal() {
            return {
              amount: this.amount.toNormal(),
              info: this.info.toNormal(),
              refund: this.refund,
              discount: this.discount,
            };
          }
        
          #RemainCalculationAmount = class {
            constructor(json) {
              this.supply = json.supply;
              this.vat = json.vat;
              this.consumer = json.consumer;
            }
          
            toNormal() {
              return {
                supply: this.supply,
                vat: this.vat,
                consumer: this.consumer,
              };
            }
          }
          
          #RemainCalculationInfo = class {
            constructor(json) {
              this.method = json.method;
              this.proof = json.proof;
              this.to = json.to;
            }
          
            toNormal() {
              return {
                method: this.method,
                proof: this.proof,
                to: this.to,
              };
            }
          }
        }
      }
      
      #Form = class {
        constructor(json) {
          this.id = json.id;
          this.guide = new DateParse(json.guide);
          this.date = new this.#FormDate(json.date);
        }
      
        toNormal() {
          return {
            id: this.id,
            guide: this.guide.toNormal(),
            date: this.date.toNormal(),
          };
        }
      
        #FormDate = class {
          constructor(json) {
            this.from = new DateParse(json.from);
            this.to = new DateParse(json.to);
            this.cancel = new DateParse(json.cancel);
          }
        
          toNormal() {
            return {
              from: this.from.toNormal(),
              to: this.to.toNormal(),
              cancel: this.cancel.toNormal(),
            };
          }
        }
      }
      
      #Meeting = class {
        constructor(json) {
          this.date = new DateParse(json.date);
          this.pastDesigners = new this.#PastDesigners();
          for (let i of json.pastDesigners) {
            const tempInstance = new this.#PastDesigner(i);
            this.pastDesigners.push(tempInstance);
          }
        }
      
        toNormal() {
          return {
            date: this.date.toNormal(),
            pastDesigners: this.pastDesigners.toNormal(),
          };
        }
      
        #PastDesigners = class extends Array {
          toNormal() {
            let arr = [];
            for (let i of this) {
              arr.push(i.toNormal());
            }
            return arr;
          }
        }
        
        #PastDesigner = class {
          constructor(json) {
            this.desid = json.desid;
            this.date = new DateParse(json.date);
          }
        
          toNormal() {
            return {
              desid: this.desid,
              date: this.date.toNormal(),
            };
          }
        }
      }
    }
  
    #ProcessDetails = class extends Array {
      constructor(json) {
        super();
        for (let i of json) {
          this.push(new this.#ProcessDetail(i));
        }
      }
    
      toNormal() {
        let arr = [];
        for (let i of this) {
          arr.push(i.toNormal());
        }
        return arr;
      }
    
      #ProcessDetail = class {
        constructor(json) {
          this.name = json.name;
          this.date = new DateParse(json.date);
          this.calendar = new this.#Calendar(json.calendar);
        }
      
        toNormal() {
          return {
            name: this.name,
            date: this.date.toNormal(),
            calendar: this.calendar.toNormal(),
          };
        }
      
        #Calendar = class {
          constructor(json) {
            this.mother = json.mother;
            this.id = json.id;
          }
        
          toNormal() {
            return {
              mother: this.mother,
              id: this.id,
            };
          }
        }
      }
    }
  
    #ProcessCall = class {
      constructor(json) {
        this.next = new DateParse(json.next);
        this.history = new this.#ProcessCallHistory(json.history);
      }
    
      toNormal() {
        return {
          next: this.next.toNormal(),
          history: this.history.toNormal(),
        };
      }
    
      #ProcessCallHistory = class extends Array {
        constructor(json) {
          super();
          for (let i of json) {
            this.push(new this.#ProcessCallHistoryFactor(i));
          }
        }
        toNormal() {
          let arr = [];
          for (let i of this) {
            arr.push(i.toNormal());
          }
          return arr;
        }
      
        #ProcessCallHistoryFactor = class {
          constructor(json) {
            this.date = new DateParse(json.date);
            this.who = json.who;
          }
        
          toNormal() {
            return {
              date: this.date.toNormal(),
              who: this.who,
            };
          }
        }
      }
    }
  
    #Design = class {
      constructor(json) {
        this.proposal = new this.#DesignProposal(json.proposal);
        this.construct = json.construct ? new this.#ConstructDetail(json.construct) : null;
        this.purchase = new this.#Purchase(json.purchase);
      }
    
      toNormal() {
        return {
          proposal: this.proposal.toNormal(),
          construct: this.construct ? this.construct.toNormal() : null,
          purchase: this.purchase.toNormal(),
        };
      }
    
      #DesignProposal = class {
        constructor(json) {
          this.provided = json.provided;
          this.limit = json.limit;
          this.detail = new this.#DesignProposalDetails();
          for (let i of json.detail) {
            const tempInstance = new this.#DesignProposalDetail(i);
            this.detail.push(tempInstance);
          }
        }
      
        toNormal() {
          return {
            provided: this.provided,
            limit: this.limit,
            detail: this.detail.toNormal(),
          };
        }
      
        #DesignProposalDetails = class extends Array {
          toNormal() {
            let arr = [];
            for (let i of this) {
              arr.push(i.toNormal());
            }
            return arr;
          }
        }
        
        #DesignProposalDetail = class {
          constructor(json) {
            this.date = new DateParse(json.date);
          }
        
          toNormal() {
            return {
              date: this.date.toNormal(),
            };
          }
        }
      }
    
      #ConstructDetail = class {
        constructor(json) {
          this.status = json.status;
          this.request = new DateParse(json.request);
          this.estimate = new this.#ConstructEstimate(json.estimate);
          this.contract = new this.#ConstructContract(json.contract);
        }
      
        toNormal() {
          return {
            status: this.status,
            request: this.request.toNormal(),
            estimate: this.estimate.toNormal(),
            contract: this.contract.toNormal(),
          };
        }
      
        #ConstructEstimate = class extends Array {
          constructor(arr) {
            super();
            for (let i of arr) {
              this.push(new this.#ConstructEstimateDocument(i));
            }
          }
          toNormal() {
            let arr = [];
            for (let i of this) {
              arr.push(i.toNormal());
            }
            return arr;
          }
          #ConstructEstimateDocument = class {
            constructor(json) {
              this.invid = json.invid;
              this.date = new DateParse(json.date);
            }
          
            toNormal() {
              return {
                invid: this.invid,
                date: this.date.toNormal(),
              };
            }
          }
        }
      
        #ConstructContract = class {
          constructor(json) {
            this.partner = json.partner;
            this.form = new this.#ConstructContractForm(json.form);
            this.payments = new this.#ConstructContractPayments(json.payments);
            this.after = new this.#ConstructContractAfter(json.after);
          }
        
          toNormal() {
            return {
              partner: this.partner,
              form: this.form.toNormal(),
              payments: this.payments.toNormal(),
              after: this.after.toNormal(),
            };
          }
        
          #ConstructContractPayments = class {
            constructor(json) {
              this.first = json.first ? new this.#ConstructContractPayment(json.first) : null;
              this.start = json.start ? new this.#ConstructContractPayment(json.start) : null;
              this.middle = json.middle ? new this.#ConstructContractPayment(json.middle) : null;
              this.remain = json.remain ? new this.#ConstructContractPayment(json.remain) : null;
            }
          
            toNormal() {
              return {
                first: this.first ? this.first.toNormal() : null,
                start: this.start ? this.start.toNormal() : null,
                middle: this.middle ? this.middle.toNormal() : null,
                remain: this.remain ? this.remain.toNormal() : null,
              };
            }
          
            #ConstructContractPayment = class {
              constructor(json) {
                this.guide = new DateParse(json.guide);
                this.date = new DateParse(json.date);
                this.cancel = new DateParse(json.cancel);
                this.calculation = new this.#ConstructContractPaymentCalculation(json.calculation);
              }
            
              toNormal() {
                return {
                  guide: this.guide.toNormal(),
                  date: this.date.toNormal(),
                  cancel: this.cancel.toNormal(),
                  calculation: this.calculation.toNormal(),
                };
              }
            
              #ConstructContractPaymentCalculation = class {
                constructor(json) {
                  this.amount = new this.#ConstructContractPaymentCalculationAmount(json.amount);
                  this.info = new this.#ConstructContractPaymentCalculationInfo(json.info);
                  this.refund = json.refund;
                }
              
                toNormal() {
                  return {
                    amount: this.amount.toNormal(),
                    info: this.info.toNormal(),
                    refund: this.refund,
                  };
                }
              
                #ConstructContractPaymentCalculationInfo = class {
                  constructor(json) {
                    this.method = json.method;
                    this.proof = json.proof;
                    this.to = json.to;
                  }
                
                  toNormal() {
                    return {
                      method: this.method,
                      proof: this.proof,
                      to: this.to,
                    };
                  }
                }
                
                #ConstructContractPaymentCalculationAmount = class {
                  constructor(json) {
                    this.supply = json.supply;
                    this.vat = json.vat;
                    this.consumer = json.consumer;
                  }
                
                  toNormal() {
                    return {
                      supply: this.supply,
                      vat: this.vat,
                      consumer: this.consumer,
                    };
                  }
                }
              }
            }
          }
        
          #ConstructContractForm = class {
            constructor(json) {
              this.id = json.id;
              this.guide = new DateParse(json.guide);
              this.date = new this.#ConstructContractFormDate(json.date);
            }
          
            toNormal() {
              return {
                id: this.id,
                guide: this.guide.toNormal(),
                date: this.date.toNormal(),
              };
            }
          
            #ConstructContractFormDate = class {
              constructor(json) {
                this.from = new DateParse(json.from);
                this.to = new DateParse(json.to);
                this.cancel = new DateParse(json.cancel);
              }
            
              toNormal() {
                return {
                  from: this.from.toNormal(),
                  to: this.to.toNormal(),
                  cancel: this.cancel.toNormal(),
                };
              }
            }
          }
        
          #ConstructContractAfter = class {
            constructor(json) {
              this.expired = new DateParse(json.expired);
              this.history = new this.#ConstructContractAfterHistory(json.history);
            }
          
            toNormal() {
              return {
                expired: this.expired.toNormal(),
                history: this.history.toNormal(),
              };
            }
          
            #ConstructContractAfterHistory = class extends Array {
              constructor(arr) {
                super();
                for (let i of arr) {
                  this.push(new this.#ConstructContractAfterHistoryFactor(i));
                }
              }
              toNormal() {
                let arr = [];
                for (let i of this) {
                  arr.push(i.toNormal());
                }
                return arr;
              }
              #ConstructContractAfterHistoryFactor = class {
                constructor(json) {
                  this.from = new DateParse(json.from);
                  this.to = new DateParse(json.to);
                  this.amount = json.amount;
                }
              
                toNormal() {
                  return {
                    from: this.from.toNormal(),
                    to: this.to.toNormal(),
                    amount: this.amount,
                  };
                }
              }
            }
          }
        }
      }
    
      #Purchase = class {
        constructor(json) {
          this.provided = json.provided;
          this.detail = new this.#PurchaseDetails();
          for (let i of json.detail) {
            const tempInstance = new this.#PurchaseDetail(i);
            this.detail.push(tempInstance);
          }
        }
      
        toNormal() {
          return {
            provided: this.provided,
            detail: this.detail.toNormal(),
          };
        }
      
        #PurchaseDetails = class extends Array {
          toNormal() {
            let arr = [];
            for (let i of this) {
              arr.push(i.toNormal());
            }
            return arr;
          }
        }
        
        #PurchaseDetail = class {
          constructor(json) {
            this.name = json.name;
            this.provider = json.provider;
            this.link = json.link;
            this.calculation = new this.#PurchaseDetailCalculation(json.calculation);
          }
        
          toNormal() {
            return {
              name: this.name,
              provider: this.provider,
              link: this.link,
              calculation: this.calculation.toNormal(),
            };
          }
        
          #PurchaseDetailCalculation = class {
            constructor(json) {
              this.amount = json.amount;
            }
            toNormal() {
              return {
                amount: this.amount,
              };
            }
          }
        }
      }
    }
  
    #Calculation = class {
      constructor(json) {
        this.method = new Menu(json.method, ["사업자(일반)", "사업자(간이)", "프리랜서"], false);
        this.percentage = json.percentage;
        this.info = new this.#Info(json.info);
        this.payments = new this.#Payments(json.payments);
      }
    
      toNormal() {
        return {
          method: this.method.toNormal(),
          percentage: this.percentage,
          info: this.info.toNormal(),
          payments: this.payments.toNormal(),
        };
      }
    
      #Info = class {
        constructor(json) {
          this.account = json.account;
          this.proof = json.proof;
          this.to = json.to;
        }
      
        toNormal() {
          return {
            account: this.account,
            proof: this.proof,
            to: this.to,
          };
        }
      }
      
      #Payments = class {
        constructor(json) {
          this.totalAmount = json.totalAmount;
          this.first = new this.#PaymentsFirst(json.first);
          this.remain = new this.#PaymentsRemain(json.remain);
        }
      
        toNormal() {
          return {
            totalAmount: this.totalAmount,
            first: this.first.toNormal(),
            remain: this.remain.toNormal(),
          };
        }
      
        #PaymentsFirst = class {
          constructor(json) {
            this.amount = json.amount;
            this.date = new DateParse(json.date);
            this.cancel = new DateParse(json.cancel);
            this.refund = json.refund;
          }
        
          toNormal() {
            return {
              amount: this.amount,
              date: this.date.toNormal(),
              cancel: this.cancel.toNormal(),
              refund: this.refund,
            };
          }
        }
        
        #PaymentsRemain = class {
          constructor(json) {
            this.amount = json.amount;
            this.date = new DateParse(json.date);
            this.cancel = new DateParse(json.cancel);
            this.refund = json.refund;
          }
        
          toNormal() {
            return {
              amount: this.amount,
              date: this.date.toNormal(),
              cancel: this.cancel.toNormal(),
              refund: this.refund,
            };
          }
        }
      }
    }
  }

  selectProposal(desid) {
    if (typeof desid !== "string") {
      throw new Error("must be desid");
    }

    let target = null;
    for (let obj of this.proposal.detail) {
      if (obj.desid === desid) {
        target = obj;
        target.proid = this.proid;
        break;
      }
    }
    return target;
  }
}

class Projects extends Array {

  toNormal() {
    let tong;
    tong = [];
    for (let i of this) {
      tong.push(i.toNormal());
    }
    return tong;
  }

  getProposals() {
    let tong;
    tong = [];
    for (let i of this) {
      for (let j of i.proposal.detail) {
        j.proid = i.proid;
        j.cliid = i.cliid;
        j.service = i.service;
        tong.push(j);
      }
    }
    return tong;
  }

  getFees() {
    let tong;
    class Fees extends Array {
      online() {
        let tong = new Fees();
        for (let i of this) {
          if (i.method === "online") {
            tong.push(i);
          }
        }
        return tong;
      }
      offline() {
        let tong = new Fees();
        for (let i of this) {
          if (i.method === "offline") {
            tong.push(i);
          }
        }
        return tong;
      }
    }

    tong = new Fees();
    for (let i of this) {
      for (let j of i.proposal.detail) {
        for (let k of j.fee) {
          k.proid = i.proid;
          k.cliid = i.cliid;
          k.desid = j.desid;
          tong.push(k);
        }
      }
    }
    return tong;
  }

  proceedFilter() {
    let arr;
    arr = new Projects();
    for (let i of this) {
      if (i.desid !== "") {
        arr.push(i);
      }
    }
    return arr;
  }

}

const withTools = function (Project) {

  const QueryString = require("querystring");

  Project.prototype.flatDeath = function () {
    const project = this.toNormal();
    const dateToString = function (dateObject, detail = false) {
      let dayString = '';

      dayString += String(dateObject.getFullYear()).slice(0, 4);
      dayString += '-';

      if (dateObject.getMonth() + 1 < 10) {
        dayString += '0' + String(dateObject.getMonth() + 1);
      } else {
        dayString += String(dateObject.getMonth() + 1);
      }

      dayString += '-';

      if (dateObject.getDate() < 10) {
        dayString += '0' + String(dateObject.getDate());
      } else {
        dayString += String(dateObject.getDate());
      }

      if (detail) {
        dayString += ' ';
        if (dateObject.getHours() < 10) {
          dayString += '0' + String(dateObject.getHours());
        } else {
          dayString += String(dateObject.getHours());
        }
        dayString += ':';
        if (dateObject.getMinutes() < 10) {
          dayString += '0' + String(dateObject.getMinutes());
        } else {
          dayString += String(dateObject.getMinutes());
        }
        dayString += ':';
        if (dateObject.getSeconds() < 10) {
          dayString += '0' + String(dateObject.getSeconds());
        } else {
          dayString += String(dateObject.getSeconds());
        }
      }

      if (/^1[678]/.test(dayString)) {
        dayString = '-';
      } else if (/^3/.test(dayString)) {
        dayString = '예정';
      }

      return dayString;
    }
    const infoToString = function (infoObj) {
      const { proof, to } = infoObj;
      let target, wording, result;
      if (infoObj.account === undefined) {
        target = infoObj.method;
        wording = "결제방법";
      } else {
        target = infoObj.account;
        wording = "계좌번호";
      }
      result = wording + ' ' + target + " / " + "수신자" + ' ' + to + " / " + "증빙" + ' ' + proof;
      return result;
    }
    const callHistoryToString = function (historyArr) {
      let totalString = '';
      historyArr.reverse();
      for (let { date, who } of historyArr) {
        totalString += dateToString(date) + ", ";
      }
      if (totalString !== '') {
        totalString = totalString.slice(0, -2);
      }
      return totalString;
    }
    const discountToString = function (discount, supply, consumer) {
      const autoComma = function (str) {
        let minus;
        let count, countArr;
        let temp, tempArr;
        if (typeof str === "number") {
          str = String(Math.floor(str));
        }
        if (/e/gi.test(str)) {
          throw new Error("is too heavy");
        }
        minus = /\-/g.test(str) ? /\-/g.exec(str)[0] : '';
        str = str.replace(/[^0-9]/g, '');
        if (str === '') {
          throw new Error("invaild number");
        }
        count = Math.ceil(str.length / 3);
        countArr = [];
        for (let i = 0; i < count; i++) {
          countArr.push([ 3 * i, 3 * (i + 1) ]);
        }
        if (countArr.length === 0) {
          throw new Error("invaild number");
        }
        tempArr = [];
        for (let arr of countArr) {
          temp = '';
          for (let i = arr[0]; i < arr[1]; i++) {
            if (str.length - 1 - i < 0) {
              temp += '';
            } else {
              temp = str[str.length - 1 - i] + temp;
            }
          }
          if (temp !== '') {
            tempArr.unshift(temp);
          }
        }
        return (minus + tempArr.join(','));
      }
      const supplyDiscount = (supply / (1 - discount)) - supply;
      const consumerDiscount = (consumer / (1 - discount)) - consumer;
      return `${String(Math.floor(discount * 100))}% (${autoComma(supplyDiscount)}원/${autoComma(consumerDiscount)}원)`;
    }

    let tong = [];
    let temp;
    let proposalDetailLength, proposalAverage;

    const { proid, cliid, desid, service: { serid, xValue, online } } = project;
    const { date: proposalDate, detail: proposalDetail } = project.proposal;
    const { status, action, outreason, call: { next, history: callHistory }, contract: { first: { guide: firstGuide, date: firstDate, cancel: firstCancel, calculation: { amount: firstAmount, info: firstInfo, refund: firstRefund, } }, remain: { guide: remainGuide, date: remainDate, cancel: remainCancel, calculation: { amount: { supply: remainSupply, vat: remainVat, consumer: remainConsumer }, info: remainInfo, refund: remainRefund, discount: remainDiscount } }, form: { guide: formGuide, date: { from: formDateFrom, to: formDateTo, cancel: formDateCancel, } }, meeting: { date: meetingDate } }, calculation: { method, percentage, info: calculationInfo, payments: { totalAmount: paymentsTotalAmount, first: { amount: paymentsFirstAmount, date: paymentsFirstDate, cancel: paymentsFirstCancel, refund: paymentsFirstRefund, }, remain: { amount: paymentsRemainAmount, date: paymentsRemainDate, cancel: paymentsRemainCancel, refund: paymentsRemainRefund, } } } } = project.process;
    const { photo: { boo: photoBoo, status: photoStatus, date: contentsPhotoDate, info: { photographer, interviewer } }, raw: { portfolio: { status: rawPortfolioStatus }, interview: { status: rawInterviewStatus }, photo: { status: rawPhotoStatus } }, share: { client: { photo: shareClientPhoto, contents: shareClientContents }, designer: { photo: shareDesignerPhoto, contents: shareDesignerContents } } } = project.contents;

    proposalDetailLength = proposalDetail.length;
    proposalAverage = 0;
    for (let i = 0; i < proposalDetailLength; i++) {
      proposalAverage += proposalDetail[i].fee[0].amount;
    }
    if (proposalDetailLength !== 0) {
      proposalAverage = Math.round(Math.round(proposalAverage / proposalDetailLength) / 1000) * 1000;
    }

    temp = {};

    temp.standard = {
      proid
    };

    temp.middle = {
      cliid,
      desid,
      serid,
      xValue,
      online
    };

    temp.info = {
      status,
      action,
      next: dateToString(next),
      callHistory: callHistoryToString(callHistory),
      firstDate: dateToString(firstDate),
      firstCancel: dateToString(firstCancel),
      firstAmount: String(firstAmount),
      firstInfo: infoToString(firstInfo),
      firstRefund: String(firstRefund),
      remainDate: dateToString(remainDate),
      remainCancel: dateToString(remainCancel),
      remainSupply: String(remainSupply),
      remainVat: String(remainVat),
      remainConsumer: String(remainConsumer),
      remainPure: String(remainConsumer - firstAmount),
      remainInfo: infoToString(remainInfo),
      remainRefund: String(remainRefund),
      discount: discountToString(remainDiscount, remainSupply, remainConsumer),
      discountDesigner: discountToString(remainDiscount, remainSupply, remainConsumer),
      formDateFrom: dateToString(formDateFrom),
      formDateTo: dateToString(formDateTo),
      formDateCancel: dateToString(formDateCancel),
      meetingDate: dateToString(meetingDate, true),
      method,
      percentage: String(percentage),
      calculationInfo: infoToString(calculationInfo),
      paymentsTotalAmount: String(paymentsTotalAmount),
      paymentsFirstAmount: String(paymentsFirstAmount),
      paymentsFirstDate: dateToString(paymentsFirstDate),
      paymentsFirstCancel: dateToString(paymentsFirstCancel),
      paymentsFirstRefund: String(paymentsFirstRefund),
      paymentsRemainAmount: String(paymentsRemainAmount),
      paymentsRemainDate: dateToString(paymentsRemainDate),
      paymentsRemainCancel: dateToString(paymentsRemainCancel),
      paymentsRemainRefund: String(paymentsRemainRefund),
      photoStatus,
      contentsPhotoDate: dateToString(contentsPhotoDate),
      proposalDate: dateToString(proposalDate),
      proposalDesigner0: (proposalDetailLength > 0 ? proposalDetail[0].desid : ''),
      proposalFee0: (proposalDetailLength > 0 ? proposalDetail[0].fee[0].amount : 0),
      proposalDesigner1: (proposalDetailLength > 1 ? proposalDetail[1].desid : ''),
      proposalFee1: (proposalDetailLength > 1 ? proposalDetail[1].fee[0].amount : 0),
      proposalDesigner2: (proposalDetailLength > 2 ? proposalDetail[2].desid : ''),
      proposalFee2: (proposalDetailLength > 2 ? proposalDetail[2].fee[0].amount : 0),
      proposalDesigner3: (proposalDetailLength > 3 ? proposalDetail[3].desid : ''),
      proposalFee3: (proposalDetailLength > 3 ? proposalDetail[3].fee[0].amount : 0),
      proposalDesigner4: (proposalDetailLength > 4 ? proposalDetail[4].desid : ''),
      proposalFee4: (proposalDetailLength > 4 ? proposalDetail[4].fee[0].amount : 0),
      proposalDesigner5: (proposalDetailLength > 5 ? proposalDetail[5].desid : ''),
      proposalFee5: (proposalDetailLength > 5 ? proposalDetail[5].fee[0].amount : 0),
      proposalDesigner6: (proposalDetailLength > 6 ? proposalDetail[6].desid : ''),
      proposalFee6: (proposalDetailLength > 6 ? proposalDetail[6].fee[0].amount : 0),
      proposalDesigner7: (proposalDetailLength > 7 ? proposalDetail[7].desid : ''),
      proposalFee7: (proposalDetailLength > 7 ? proposalDetail[7].fee[0].amount : 0),
      proposalDesigner8: (proposalDetailLength > 8 ? proposalDetail[8].desid : ''),
      proposalFee8: (proposalDetailLength > 8 ? proposalDetail[8].fee[0].amount : 0),
      proposalDesigner9: (proposalDetailLength > 9 ? proposalDetail[9].desid : ''),
      proposalFee9: (proposalDetailLength > 9 ? proposalDetail[9].fee[0].amount : 0),
      proposalAverage,
    };

    tong.push(temp);

    return tong;
  }

  Project.prototype.planeDeath = function () {
    const project = this.toNormal();
    const dateToString = function (dateObject, detail = false) {
      let dayString = '';

      dayString += String(dateObject.getFullYear()).slice(0, 4);
      dayString += '-';

      if (dateObject.getMonth() + 1 < 10) {
        dayString += '0' + String(dateObject.getMonth() + 1);
      } else {
        dayString += String(dateObject.getMonth() + 1);
      }

      dayString += '-';

      if (dateObject.getDate() < 10) {
        dayString += '0' + String(dateObject.getDate());
      } else {
        dayString += String(dateObject.getDate());
      }

      if (detail) {
        dayString += ' ';
        if (dateObject.getHours() < 10) {
          dayString += '0' + String(dateObject.getHours());
        } else {
          dayString += String(dateObject.getHours());
        }
        dayString += ':';
        if (dateObject.getMinutes() < 10) {
          dayString += '0' + String(dateObject.getMinutes());
        } else {
          dayString += String(dateObject.getMinutes());
        }
        dayString += ':';
        if (dateObject.getSeconds() < 10) {
          dayString += '0' + String(dateObject.getSeconds());
        } else {
          dayString += String(dateObject.getSeconds());
        }
      }

      if (/^1[678]/.test(dayString)) {
        dayString = '-';
      } else if (/^3/.test(dayString)) {
        dayString = '예정';
      }

      return dayString;
    }

    let tong = [];
    let temp;

    const { proid, cliid, desid } = project;
    const { status, action } = project.process;
    const { photo: { boo: photoBoo, status: photoStatus, date: contentsPhotoDate, info: { photographer, interviewer } }, raw: { portfolio: { status: rawPortfolioStatus, link: rawPortfolioLink }, interview: { status: rawInterviewStatus, link: rawInterviewLink }, photo: { status: rawPhotoStatus, link: rawPhotoLink } }, share: { client: { photo: shareClientPhoto, contents: shareClientContents }, designer: { photo: shareDesignerPhoto, contents: shareDesignerContents } } } = project.contents;

    temp = {};

    temp.standard = {
      proid
    };

    temp.middle = {
      cliid,
      desid,
    };

    temp.info = {
      status,
      action,
      photoBoo,
      photoStatus,
      contentsPhotoDate: dateToString(contentsPhotoDate),
      photographer,
      interviewer,
      rawPortfolioStatus,
      rawPortfolioLink: QueryString.escape(rawPortfolioLink),
      rawInterviewStatus,
      rawInterviewLink: QueryString.escape(rawInterviewLink),
      rawPhotoStatus,
      rawPhotoLink: QueryString.escape(rawPhotoLink),
      shareClientPhoto: dateToString(shareClientPhoto),
      shareClientContents: dateToString(shareClientContents),
      shareDesignerPhoto: dateToString(shareDesignerPhoto),
      shareDesignerContents: dateToString(shareDesignerContents),
    };

    tong.push(temp);

    return tong;
  }

  Project.prototype.dimensionSqueeze = function () {
    const tong = this.flatDeath();
    let result, tempObj;

    result = [];
    for (let { standard, middle, info } of tong) {
      tempObj = {};
      for (let i in standard) {
        tempObj[i] = standard[i];
      }
      for (let i in middle) {
        tempObj[i] = middle[i];
      }
      for (let i in info) {
        tempObj[i] = info[i];
      }
      result.push(tempObj);
    }

    return result;
  }

  const Average = function (obj) {
    this.proid = obj.proid;
    this.cliid = obj.cliid;
    this.average = obj.average;
    this.averageRaw = obj.averageRaw;
    this.contract = obj.contract;
    this.length = obj.length;
  }

  Project.prototype.returnAverage = function () {
    const moneyParsing = function (num) {
      let str = String(Math.round(num));
      if (str.length > 3) {
        str = str.slice(0, -3) + ',' + str.slice(-3);
      }
      return `${str}만원`;
    }
    let result, total, pageNumber;

    total = 0;
    pageNumber = 0;
    for (let { fee } of this.proposal.detail) {
      for (let { amount } of fee) {
        total += amount;
        pageNumber++;
      }
    }

    result = {
      proid: this.proid,
      cliid: this.cliid,
      average: moneyParsing((total / pageNumber) / 10000),
      averageRaw: total / pageNumber,
      contract: (/^d/.test(this.desid) && this.process.status !== "드랍" && this.process.status !== "홀딩"),
      length: pageNumber,
    };

    return new Average(result);
  }

  return Project;
}

const withToolsArr = function (Projects) {

  class AverageTong extends Array {
    averageReport() {
      const moneyParsing = function (num) {
        let str = String(Math.round(num));
        if (str.length > 3) {
          str = str.slice(0, -3) + ',' + str.slice(-3);
        }
        return `${str}만원`;
      }
      let result, total, contractNum, contractProposalTotal;
      let proidArr, cliidArr;

      total = 0;
      contractNum = 0;
      contractProposalTotal = 0;
      proidArr = [];
      cliidArr = [];

      for (let { proid, cliid, averageRaw, contract } of this) {
        total += averageRaw;
        if (contract) {
          contractNum++;
          contractProposalTotal += averageRaw;
        }
        proidArr.push(proid);
        cliidArr.push(cliid);
      }

      result = { proidArr, cliidArr };
      result.proposal = proidArr.length;
      result.contract = contractNum;
      result.average = {};
      if (this.length === 0) {
        result.average.proposal = "0만원";
      } else {
        result.average.proposal = moneyParsing((total / this.length) / 10000)
      }
      if (contractNum === 0) {
        result.average.contract = "0만원";
      } else {
        result.average.contract = moneyParsing((contractProposalTotal / contractNum) / 10000);
      }

      return result;
    }
  }

  Projects.prototype.flatDeath = function () {
    let tong, tempArr;
    tong = [];
    for (let i of this) {
      tempArr = i.flatDeath();
      for (let j of tempArr) {
        tong.push(j);
      }
    }
    return tong;
  }

  Projects.prototype.planeDeath = function () {
    let tong, tempArr;
    tong = [];
    for (let i of this) {
      tempArr = i.planeDeath();
      for (let j of tempArr) {
        tong.push(j);
      }
    }
    return tong;
  }

  Projects.prototype.returnAverage = function () {
    let tong, tempArr;
    tong = new AverageTong();
    for (let i of this) {
      tong.push(i.returnAverage());
    }
    return tong;
  }

  Projects.prototype.dimensionSqueeze = function () {
    const TABLE_NAME = "project";
    const LONG_TARGETS = [];
    class SqlModel {
      constructor(sample) {
        for (let i in sample) {
          if (typeof sample[i] === "string") {
            this[i] = "VARCHAR(255)";
          } else if (typeof sample[i] === "number") {
            this[i] = "INT(11)";
          } else if (typeof sample[i] === "boolean") {
            this[i] = "INT(11)";
          } else {
            this[i] = "VARCHAR(255)";
          }
          if (LONG_TARGETS.includes(i)) {
            this[i] = "TEXT";
          }
        }
      }

      getName() {
        return TABLE_NAME;
      }

      getCreateSql() {
        let sql = "CREATE TABLE \`" + this.getName() + "\` (";
        sql += "id INT(11) NOT NULL AUTO_INCREMENT,";
        sql += " ";
        for (let i in this) {
          sql += "\`";
          sql += i;
          sql += "\`";
          sql += " ";
          sql += this[i];
          sql += ", ";
        }
        sql += "PRIMARY KEY (id));";
        return sql;
      }

      getDropSql() {
        let sql = "DROP TABLE " + this.getName() + ";";
        return sql;
      }

    }
    class SqlTong extends Array {
      getName() {
        return TABLE_NAME;
      }

      getInsertSql() {
        let arr = [];
        for (let i of this) {
          arr.push(i.getInsertSql());
        }
        return arr;
      }

    }
    class SqlTongFactor {
      constructor(sample) {
        for (let i in sample) {
          if (typeof sample[i] === "string") {
            this[i] = sample[i];
          } else if (typeof sample[i] === "number") {
            this[i] = sample[i];
          } else if (typeof sample[i] === "boolean") {
            if (sample[i]) {
              this[i] = 1;
            } else {
              this[i] = 0;
            }
          } else {
            this[i] = JSON.stringify(sample[i]);
          }
        }
      }

      getName() {
        return TABLE_NAME;
      }

      getInsertSql() {
        let sql = "INSERT INTO \`" + this.getName() + "\` (";
        for (let i in this) {
          sql += "\`";
          sql += i;
          sql += "\`";
          sql += ",";
        }

        sql = sql.slice(0, -1);
        sql += ") VALUES (";

        for (let i in this) {
          if (typeof this[i] === "number") {
            sql += this[i];
          } else {
            if (/^[0-9][0-9][0-9][0-9]\-[0-9][0-9]\-[0-9][0-9]$/gi.test(this[i])) {
              sql += "STR_TO_DATE('";
              sql += this[i].replace(/'/g, '"');
              sql += "', '%Y-%m-%d')";
            } else if (/^[0-9][0-9][0-9][0-9]\-[0-9][0-9]\-[0-9][0-9] [0-9][0-9]\:[0-9][0-9]\:[0-9][0-9]$/gi.test(this[i])) {
              sql += "STR_TO_DATE('";
              sql += this[i].replace(/'/g, '"');
              sql += "', '%Y-%m-%d %H:%i:%s')";
            } else {
              sql += "'";
              sql += this[i].replace(/'/g, '"');
              sql += "'";
            }
          }
          sql += ",";
        }

        sql = sql.slice(0, -1);
        sql += ");";

        return sql;
      }
    }

    let tong, tempArr;
    let sample, model;

    tong = new SqlTong();

    for (let i of this) {
      tempArr = i.dimensionSqueeze();
      for (let j of tempArr) {
        tong.push(new SqlTongFactor(j));
      }
    }

    if (tong.length > 0) {
      sample = tong[0];
      model = new SqlModel(sample);
      return { model, data: tong };
    } else {
      return null;
    }
  }

  Projects.prototype.search = function (proid) {
    let result = null;
    for (let i of this) {
      if (i.proid === proid) {
        result = i;
        break;
      }
    }
    return result;
  }
  
  Projects.prototype.searchByCliid = function (cliid, isContract = false) {
    if (cliid === undefined) {
      throw new Error("must be cliid");
    }
    let result = null;
    let final = null;
    if (!isContract) {
      for (let i of this) {
        if (i.cliid === cliid) {
          result = i;
          break;
        }
      }
      return result;
    } else {
      result = [];
      for (let i of this) {
        if (/^d/.test(i.desid)) {
          if (i.cliid === cliid) {
            result.push(i);
          }
        }
      }
      final = [];
      for (let i of result) {
        if (i.process.contract.first.date.valueOf() > (new Date(2000, 0, 1).valueOf())) {
          final.push(i);
        }
      }
      return final;
    }
  }
  return Projects;
}

module.exports = { ProjectMap, Project, Projects, Tools: { withTools, withToolsArr } };
